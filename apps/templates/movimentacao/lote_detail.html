{% extends 'layouts/base.html' %}
{% block title %}Detalhe do Lote{% endblock %}
{% block conteudo %}
<div class="content">
    <div class="page-header">
        <h1>Lote: {{ lote.numero_lote }}</h1>
        <a href="{% url 'movimentacao:lote_list' %}" class="btn btn-secondary">Voltar</a>
    </div>
    <div class="detail-card">
        <div class="detail-info">
            <div class="detail-row"><span class="detail-label">Produto:</span> {{ lote.variacao.produto.nome }}</div>
            <div class="detail-row"><span class="detail-label">Variação:</span> {{ lote.variacao.tamanho|default:"-" }} / {{ lote.variacao.unidade }}</div>
            <div class="detail-row"><span class="detail-label">Quantidade:</span> {{ lote.quantidade|floatformat:2 }}</div>
            <div class="detail-row"><span class="detail-label">Preço unitário:</span> R$ {{ lote.preco_unitario|floatformat:2 }}</div>
            <div class="detail-row"><span class="detail-label">Data de Entrada:</span> {{ lote.data_entrada|date:"d/m/Y H:i" }}</div>
            <div class="detail-row"><span class="detail-label">Nota Fiscal:</span>
                {% if lote.documento_nfe %}
                    <a href="{{ lote.documento_nfe.url }}" target="_blank">Ver XML</a>
                {% else %}
                    -
                {% endif %}
            </div>
        </div>
    </div>
    <div class="detail-card">
        <h2>Movimentações Relacionadas</h2>
        <table class="table">
            <thead>
                <tr>
                    <th>Data</th>
                    <th>Tipo</th>
                    <th>Variação</th>
                    <th>Quantidade</th>
                    <th>Usuário</th>
                    <th>Obs</th>
                </tr>
            </thead>
            <tbody>
                {% for m in lote.movimentacao_set.all %}
                <tr>
                    <td>{{ m.data|date:"d/m/Y H:i" }}</td>
                    <td>{{ m.tipo.nome }}</td>
                    <td>{{ m.variacao.tamanho|default:"-" }}</td>
                    <td>{{ m.quantidade }}</td>
                    <td>{{ m.usuario }}</td>
                    <td>{{ m.observacao }}</td>
                </tr>
                {% empty %}
                <tr><td colspan="6">Nenhuma movimentação registrada neste lote.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
